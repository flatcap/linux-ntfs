<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="description" content="LDM Logical Disk Manager Documentation">
    <link rel="stylesheet" type="text/css" href="../style/ldm.css">
    <link rel="icon" href="../style/ldmicon.png" type="image/png">
    <link rel="start" type="text/html" href="index.html" title="LDM Documentation">
    <link rel="next" href="klog.html">
    <link rel="previous" href="vmdb.html">
    <link rel="contents" href="../index.html">
    <title>VBLK - Technical - LDM Documentation</title>
  </head>

  <body>
    <table class="toolbar" summary="toolbar" cellspacing="0">
      <tr>
        <td class="toolbar"><div class="toolbar"><a class="toolbar" accesskey="1" href="../index.html">Home</a></div></td>
        <td class="toolbar"><div class="toolbar"><a class="toolbar" accesskey="2" href="../overview/index.html">Overview</a></div></td>
	<td class="toolbar"><a class="toolbar" accesskey="3" href="../technical/index.html">Technical</a></td>
      </tr>
    </table>

    <h1>VBLK - Technical</h1>

    <a class="prevnext" accesskey="," href="vmdb.html">Previous</a>
    <a class="prevnext" accesskey="." href="klog.html">Next</a> 

    <h2>Introduction</h2>

    <p>
    The VBLKs are the workhorse of the database.  Each Disk Group, Disk, Volume,
    Partition and Component is represented by a VBLK.  The elements'
    relationships are shown in the
    <a href="../overview/database.html">Database Overview</a>.
    </p>

    <p>
    Each VBLK is 128 bytes long and has a standard 16 byte header.  Sometimes
    the VBLK isn't large enough to store all the information, so two must be
    used (Extended VBLKs).
    </p>

    <p>
    A table size of <q>P</q> implies the field is prefixed by a one byte length
    marker.  Unless a string is listed as NULL terminated, it isn't.
    </p>

    <h2>Standard VBLK Header</h2>

    <p>
    Every VBLK has a standard 16 byte header, containing accounting
    information.
    </p>

    <table summary="" cellspacing="0">
      <tr>
        <th class="numeric">Offset</th>
        <th class="numeric">Size</th>
        <th>Description</th>
      </tr>
      <tr>
        <td class="numeric">0x00</td>
        <td class="numeric">4</td>
        <td>"VBLK" Magic Number</td>
      </tr>
      <tr>
        <td class="numeric">0x04</td>
        <td class="numeric">4</td>
        <td>Sequence Number</td>
      </tr>
      <tr>
        <td class="numeric">0x08</td>
        <td class="numeric">4</td>
        <td>Group Number</td>
      </tr>
      <tr>
        <td class="numeric">0x0C</td>
        <td class="numeric">2</td>
        <td>Record Number (x of y)</td>
      </tr>
      <tr>
        <td class="numeric">0x0E</td>
        <td class="numeric">2</td>
        <td>Number of Records</td>
      </tr>
    </table>

    <h3>Notes</h3>

    <p>
    The Sequence Numbers start at 4.
    0&nbsp;-&nbsp;3 are effectively the VMDB Header block.
    </p>

    <p>
    The Group Number is never zero.
    </p>

    <p>
    The Record Type can be 0x32 (Component), 0x33 (Partition),
    0x34 (Disk), 0x35 (Disk Group) or 0x51 (Volume).
    </p>

    <h3>Extended VBLKs</h3>

    <p>
    The number of VBLKs is shown in "Number of Records" and "Record Number"
    is a zero-based index.  To keep track of the extended VBLKs, each set
    is given a unique "Group Number".
    </p>

    <p>
    N.B.  Extended VBLKs may not be located contiguously in the VMDB.
    </p>

    <h3>Update Status</h3>

    <p>
    To prevent data loss during updates, and changes to the VBLKs are
    logged.  In the event of a power failure, the database can be
    rolled back to a consistant state.  The table below shows what each
    VBLK Update Status means.
    </p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0x00</td>
	<td>VBLK is in a consistant state</td>
      </tr>
      <tr>
	<td>0x01</td>
	<td>VBLK is about to be deleted, but is still active</td>
      </tr>
      <tr>
	<td>0x02</td>
	<td>VBLK has just been created, but it is not yet active)</td>
      </tr>
    </table>

    <h2>Volume (0x51)</h2>

    <table summary="" cellspacing="0">
      <tr>
	<th class="numeric">Offset</th>
	<th class="numeric">Size</th>
	<th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Volume Type (b)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">1</td>
	<td>Zero</td>
      </tr>
      <tr>
	<td class="numeric">..0x19</td>
	<td class="numeric">14</td>
	<td>Volume State (string, null padded) (c)</td>
      </tr>
      <tr>
	<td class="numeric">..0x27</td>
	<td class="numeric">1</td>
	<td>Volume Type? (3 Normal, 4 RAID)</td>
      </tr>
      <tr>
	<td class="numeric">..0x28</td>
	<td class="numeric">1</td>
	<td>Don't know (always 1)</td>
      </tr>
      <tr>
	<td class="numeric">..0x29</td>
	<td class="numeric">1</td>
	<td>Volume Number (d)</td>
      </tr>
      <tr>
	<td class="numeric">..0x2A</td>
	<td class="numeric">3</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x2D</td>
	<td class="numeric">1</td>
	<td>Flags? (0x11 Normal, 0x13 RAID, 0x15 ?, 0x17 ?)</td>
      </tr>
      <tr>
	<td class="numeric">..0x2E</td>
	<td class="numeric">P</td>
	<td>Number of Children</td>
      </tr>
      <tr>
	<td class="numeric">..0x2E</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x36</td>
	<td class="numeric">8</td>
	<td><div class="xxx">Id? or 0x00</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x3E</td>
	<td class="numeric">P</td>
	<td>Size</td>
      </tr>
      <tr>
	<td class="numeric">..0x3E</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
        <td class="numeric">..0x42</td>
	<td class="numeric">1</td>
	<td>Partition Type, e.g. 7 = NTFS</td>
      </tr>
      <tr>
	<td class="numeric">..0x43</td>
	<td class="numeric">16</td>
	<td>Volume Id (GUID, ???)</td>
      </tr>
      <tr>
	<td class="numeric">..0x53</td>
	<td class="numeric">P</td>
	<td><div class="opt">Id1?</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x53</td>
	<td class="numeric">P</td>
	<td><div class="opt">Id2?</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x53</td>
	<td class="numeric">P</td>
	<td><div class="opt">Size (if children?)</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x53</td>
	<td class="numeric">P</td>
	<td><div class="opt">Drive Hint (string)</div></td>
      </tr>
    </table>

    <p>The flags denote the presence of an optional field</p>
    <p>N.B.  Id1 and Id2 are mutually exclusive.</p>
    <p>N.B.  The optional fields will always be in the order: Id, Size, Drive Hint</p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0x08</td>
	<td>Id1?</td>
      </tr>
      <tr>
	<td>0x20</td>
	<td>Id2?</td>
      </tr>
      <tr>
	<td>0x80</td>
	<td>Size</td>
      </tr>
      <tr>
	<td>0x02</td>
	<td>Drive Hint</td>
      </tr>
    </table>

    <p>
    (a) Revision 5 of VBLK type 1<br>
    (b) Volume Type: "gen" or "raid5"<br>
    (c) Volume State: "ACTIVE"<br>
    (d) Starts at 5 and unused numbers are reused
    </p>

    <h2>Component (0x32)</h2>

    <table summary="" cellspacing="0">
      <tr>
        <th class="numeric">Offset</th>
        <th class="numeric">Size</th>
        <th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Volume State (b)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">1</td>
	<td>Component type (c)</td>
      </tr>
      <tr>
	<td class="numeric">..0x19</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x1D</td>
	<td class="numeric">P</td>
	<td>Number of children</td>
      </tr>
      <tr>
	<td class="numeric">..0x1D</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x25</td>
	<td class="numeric">8</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x2D</td>
	<td class="numeric">P</td>
	<td>Parent Id (A Volume)</td>
      </tr>
      <tr>
	<td class="numeric">..0x2D</td>
	<td class="numeric">1</td>
	<td>Zero</td>
      </tr>
      <tr>
	<td class="numeric">..0x2E</td>
	<td class="numeric">P</td>
	<td><div class="opt">Stripe Size (in sectors)</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x2E</td>
	<td class="numeric">P</td>
	<td><div class="opt">Number of Columns</div></td>
      </tr>
    </table>

    <p>The flags denote the presence of an optional field</p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
        <th>Description</th>
      </tr>
      <tr>
	<td>0x10</td>
	<td>Both optional fields</td>
      </tr>
    </table>

    <p>
    (a) Revision 3 of VBLK type 2<br>
    (b) Component type: 1 Stripe, 2 Basic or Spanned, 3 RAID<br>
    (c) Volume State: "ACTIVE"
    </p>

    <h2>Partition (0x33)</h2>

    <table summary="" cellspacing="0">
      <tr>
        <th class="numeric">Offset</th>
        <th class="numeric">Size</th>
        <th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x1C</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x24</td>
	<td class="numeric">8</td>
	<td>Start</td>
      </tr>
      <tr>
	<td class="numeric">..0x2C</td>
	<td class="numeric">8</td>
	<td>Volume Offset</td>
      </tr>
      <tr>
	<td class="numeric">..0x34</td>
	<td class="numeric">P</td>
	<td>Size</td>
      </tr>
      <tr>
	<td class="numeric">..0x34</td>
	<td class="numeric">P</td>
	<td>Parent's Object Id (Component)</td>
      </tr>
      <tr>
	<td class="numeric">..0x34</td>
	<td class="numeric">P</td>
	<td>Disk's Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x34</td>
	<td class="numeric">P</td>
	<td><div class="opt">Component part index</div></td>
      </tr>
    </table>

    <p>The flags denote the presence of an optional field</p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
        <th>Description</th>
      </tr>
      <tr>
	<td>0x08</td>
	<td>Component part index</td>
      </tr>
    </table>

    <p>
    (a) Revision 3 of VBLK type 3
    </p>

    <h2>Disk (0x34)</h2>

    <table summary="" cellspacing="0">
      <tr>
	<th class="numeric">Offset</th>
	<th class="numeric">Size</th>
	<th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Disk Id (GUID, string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Alternate Name</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x1D</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
    </table>

    <p>N.B. This VBLK type doesn't have any flags</p>

    <p>
    (a) Revision 3 of VBLK type 4
    </p>

    <h2>Disk (0x44)</h2>

    <table summary="" cellspacing="0">
      <tr>
	<th class="numeric">Offset</th>
	<th class="numeric">Size</th>
	<th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">16</td>
	<td>Disk Id (GUID, binary)</td>
      </tr>
      <tr>
	<td class="numeric">..0x28</td>
	<td class="numeric">16</td>
	<td>Disk Id (GUID, binary)</td>
      </tr>
      <tr>
	<td class="numeric">..0x38</td>
	<td class="numeric">3</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x3B</td>
	<td class="numeric">2</td>
	<td><div class="xxx">Id?</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x3D</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
    </table>

    <p>N.B. This VBLK type doesn't have any flags</p>

    <p>
    (a) Revision 4 of VBLK type 4
    </p>

    <h2>Disk Group (0x35)</h2>

    disk group name limited to 28 chars

    <table summary="" cellspacing="0">
      <tr>
	<th class="numeric">Offset</th>
	<th class="numeric">Size</th>
	<th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Disk Group Id (GUID, string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x1C</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x24</td>
	<td class="numeric">P</td>
	<td><div class="opt">0xFFFFFFFF</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x24</td>
	<td class="numeric">P</td>
	<td><div class="opt">0xFFFFFFFF</div></td>
      </tr>
    </table>

    <p>The flags denote the presence of an optional field</p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0x08</td>
	<td>Both optional fields (probably)</td>
      </tr>
    </table>

    <p>
    (a) Revision 3 of VBLK type 5
    </p>

    <h2>Disk Group (0x45)</h2>

    <table summary="" cellspacing="0">
      <tr>
	<th class="numeric">Offset</th>
	<th class="numeric">Size</th>
	<th>Description</th>
      </tr>
      <tr>
	<td class="numeric">0x00</td>
	<td class="numeric">16</td>
	<td>Standard VBLK Header</td>
      </tr>
      <tr>
	<td class="numeric">0x10</td>
	<td class="numeric">2</td>
	<td>Update Status</td>
      </tr>
      <tr>
	<td class="numeric">0x12</td>
	<td class="numeric">2</td>
	<td>Record type and flags (a)</td>
      </tr>
      <tr>
	<td class="numeric">0x14</td>
	<td class="numeric">4</td>
	<td>Data length</td>
      </tr>
      <tr>
	<td class="numeric">0x18</td>
	<td class="numeric">P</td>
	<td>Object Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">P</td>
	<td>Name (string)</td>
      </tr>
      <tr>
	<td class="numeric">..0x18</td>
	<td class="numeric">16</td>
	<td>Disk Group Id (GUID, binary)
      </tr>
      <tr>
	<td class="numeric">..0x28</td>
	<td class="numeric">16</td>
	<td>Disk Set Id (GUID, binary)
      </tr>
      <tr>
	<td class="numeric">..0x38</td>
	<td class="numeric">4</td>
	<td>Zeros</td>
      </tr>
      <tr>
	<td class="numeric">..0x3C</td>
	<td class="numeric">8</td>
	<td>Log Commit Id</td>
      </tr>
      <tr>
	<td class="numeric">..0x44</td>
	<td class="numeric">P</td>
	<td><div class="opt">0xFFFFFFFF</div></td>
      </tr>
      <tr>
	<td class="numeric">..0x44</td>
	<td class="numeric">P</td>
	<td><div class="opt">0xFFFFFFFF or 0x00</div></td>
      </tr>
    </table>

    <p>The flags denote the presence of an optional field</p>

    <table summary="" cellspacing="0">
      <tr>
	<th>Flags</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0x08</td>
	<td>Both optional fields (probably)</td>
      </tr>
    </table>

    <p>
    (a) Revision 4 of VBLK type 5
    </p>

    <br>
    <a class="contact" href="../home/license.html">Copyright &copy; 2002, </a>
    $Date: 2002/06/20 14:40:21 $
    <a class="contact" href="http://validator.w3.org/checklink?uri=referer">L</a>
    <a class="contact" href="http://validator.w3.org/check?uri=referer">H</a>
    <a class="contact" href="http://jigsaw.w3.org/css-validator/validator?uri=referer">C</a>
  </body>
</html>

